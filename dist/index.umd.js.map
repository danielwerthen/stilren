{"version":3,"file":"index.umd.js","sources":["../src/Modifier.ts","../src/Node.ts","../src/default-pseudos.js","../src/index.ts","../src/Parser.ts"],"sourcesContent":["function getClassName(instance: Modifier) {\n  return Reflect.getPrototypeOf(instance).constructor.name;\n}\n\nconst modifiers: { [key: string]: Modifier } = {};\n\nexport type ModifierType = \"prefix\" | \"suffix\";\n\nexport class Modifier {\n  value: string;\n  type: ModifierType;\n  constructor(value: string, type: ModifierType) {\n    const id = `stil-ren-modifier:${getClassName(this)}+${value}`;\n    const mod = modifiers[id];\n    this.value = value;\n    this.type = type;\n    if (mod) {\n      return mod;\n    }\n    modifiers[id] = this;\n  }\n  canCombine(_withMod: Modifier) {\n    return false;\n  }\n  combine(withMod: Modifier): Modifier {\n    throw new Error(\"Cannot combine with \" + getClassName(withMod));\n  }\n  getKey() {\n    return this.value;\n  }\n\n  toString() {\n    return this.getKey();\n  }\n\n  static combineModifiers(mods: Modifier[]) {\n    return mods.reduce<Modifier[]>((sum: Modifier[], item: Modifier) => {\n      const last = sum[sum.length - 1];\n      if (last && last.canCombine(item)) {\n        return [...sum.slice(0, sum.length - 1), last.combine(item)];\n      }\n      return [...sum, item];\n    }, []);\n  }\n}\n\nexport class MediaModifier extends Modifier {\n  constructor(value: string) {\n    super(value, \"prefix\");\n  }\n  canCombine(withMod: Modifier) {\n    return withMod instanceof MediaModifier;\n  }\n  combine(withMod: Modifier): Modifier {\n    const alpha = this;\n    const beta = withMod;\n    if (alpha === beta) {\n      return beta;\n    }\n    const left = alpha.value < beta.value ? alpha : beta;\n    const right = alpha.value < beta.value ? beta : alpha;\n    return new MediaModifier(`${left.value} or ${right.value}`);\n  }\n  getKey() {\n    return `@media ${this.value}`;\n  }\n}\n\nexport class PseudoModifier extends Modifier {\n  constructor(value: string) {\n    super(value, \"suffix\");\n  }\n  canCombine(withMod: Modifier) {\n    return withMod instanceof PseudoModifier;\n  }\n  combine(withMod: Modifier): Modifier {\n    const alpha = this;\n    const beta = withMod;\n    if (alpha === beta) {\n      return beta;\n    }\n    const left = alpha.value < beta.value ? alpha : beta;\n    const right = alpha.value < beta.value ? beta : alpha;\n    return new PseudoModifier(`${left.value}:${right.value}`);\n  }\n  getKey() {\n    return `:${this.value}`;\n  }\n}\n","import { Modifier } from \"./Modifier\";\n\ntype Props = { [key: string]: unknown | Props };\n\nfunction getProps(modifier: Modifier, props: Props): Props {\n  if (!(modifier instanceof Modifier)) {\n    throw new Error(\"Cannot get branch of unknown modifier\");\n  }\n  const id = modifier.getKey();\n  if (!props[id]) {\n    props[id] = {};\n  }\n  return props[id] as Props;\n}\n\nexport default class Node {\n  props: { [key: string]: unknown };\n  constructor(props = {}) {\n    this.props = props;\n  }\n  set(key: string, value: unknown, mods: Modifier[]) {\n    const node = mods.reduce((node, mod) => getProps(mod, node), this.props);\n    node[key] = value;\n  }\n  getNode(mods: Modifier[]): Node {\n    if (mods.length < 1) {\n      return this;\n    }\n    const props = mods.reduce((node, mod) => getProps(mod, node), this.props);\n    return new Node(props);\n  }\n}\n","\nexport default {\n  Active: \":active\",\n  Checked: \":checked\",\n  Default: \":default\",\n  Disabled: \":disabled\",\n  Empty: \":empty\",\n  Enabled: \":enabled\",\n  First: \":first\",\n  FirstChild: \":first-child\",\n  FirstOfType: \":first-of-type\",\n  Fullscreen: \":fullscreen\",\n  Focus: \":focus\",\n  Hover: \":hover\",\n  Indeterminate: \":indeterminate\",\n  InRange: \":in-range\",\n  Invalid: \":invalid\",\n  LastChild: \":last-child\",\n  LastOfType: \":last-of-type\",\n  Link: \":link\",\n  OnlyChild: \":only-child\",\n  OnlyOfType: \":only-of-type\",\n  Optional: \":optional\",\n  OutOfRange: \":out-of-range\",\n  ReadOnly: \":read-only\",\n  ReadWrite: \":read-write\",\n  Required: \":required\",\n  Scope: \":scope\",\n  Target: \":target\",\n  Valid: \":valid\",\n  Visited: \":visited\"\n}\n","import {\n  ExtensionProvider,\n  originalCreateElement\n} from \"@dwerthen/react-extension\";\nimport React from \"react\";\nimport { createParser } from \"./Parser\";\nimport Node from \"./Node\";\nimport defaultPseudos from \"./default-pseudos\";\nimport { PseudoModifier, MediaModifier } from \"./Modifier\";\nimport {\n  StandardEngine,\n  renderDeclarativeRules,\n  StyleObject\n} from \"styletron-standard\";\n\nconst defaultMediaPrefixes = Object.keys(process.env)\n  .filter(key => key.startsWith(\"npm_package_stilren_mediaPrefixes\"))\n  .reduce((sum, key) => {\n    const target = key.replace(\"npm_package_stilren_mediaPrefixes_\", \"\");\n    return Object.assign(sum, { [target]: process.env[key] });\n  }, {});\n\nexport type StyleProps = { [key: string]: unknown };\n\nexport type RenderStyleFn = (props: StyleProps) => string;\n\nexport function createRenderStyle({\n  mediaPrefixes = defaultMediaPrefixes,\n  pseudoSuffixes = defaultPseudos,\n  styletron\n}: {\n  styletron: StandardEngine;\n  mediaPrefixes?: { [key: string]: string };\n  pseudoSuffixes?: { [key: string]: string };\n}): RenderStyleFn {\n  const parser = createParser(\n    Object.keys(mediaPrefixes).reduce(\n      (sum, key) => ({\n        ...sum,\n        [key]: new MediaModifier(mediaPrefixes[key])\n      }),\n      {}\n    ),\n    Object.keys(pseudoSuffixes).reduce(\n      (sum, key) => ({\n        ...sum,\n        [key]: new PseudoModifier(pseudoSuffixes[key])\n      }),\n      {}\n    )\n  );\n\n  function renderStyle(props: StyleProps) {\n    const node = new Node();\n    for (var key in props) {\n      if (props.hasOwnProperty(key)) {\n        const value = props[key];\n        const [inner, mods] = parser(key.substr(1));\n        node.set(inner, value, mods);\n      }\n    }\n    const tx = renderDeclarativeRules(node.props as StyleObject, styletron);\n    return styletron.renderStyle(tx);\n  }\n\n  return renderStyle;\n}\n\nconst emptyRender = () => \"\";\n\nexport const stilrenContext = React.createContext<{\n  renderStyle: RenderStyleFn;\n}>({\n  renderStyle: emptyRender\n});\n\nexport function StilrenProvider({\n  mediaPrefixes,\n  pseudoSuffixes,\n  styletron,\n  propPrefix = \"$\",\n  children\n}: {\n  styletron: StandardEngine;\n  mediaPrefixes?: { [key: string]: string };\n  pseudoSuffixes?: { [key: string]: string };\n  propPrefix?: string;\n  children: any;\n}) {\n  const renderStyle = React.useMemo(\n    () => createRenderStyle({ styletron, mediaPrefixes, pseudoSuffixes }),\n    []\n  );\n  const extender = React.useMemo(\n    () => createExtender(renderStyle, propPrefix),\n    [renderStyle]\n  );\n  const ctx = React.useMemo(() => ({ renderStyle }), [renderStyle]);\n  return originalCreateElement(\n    stilrenContext.Provider,\n    { value: ctx },\n    originalCreateElement(ExtensionProvider, { value: extender }, children)\n  );\n}\nexport const StilrenConsumer = stilrenContext.Consumer;\n\nexport function useStilren(props: StyleProps) {\n  const { renderStyle } = React.useContext(stilrenContext);\n  if (renderStyle === emptyRender) {\n    console.warn(\"Stilren Provider must be initialized with a renderStyle\");\n  }\n  return renderStyle(props);\n}\n\nexport function createExtender(\n  renderStyle: RenderStyleFn,\n  propPrefix: string = \"$\"\n) {\n  return (_tagName: string, props: { [key: string]: unknown }) => {\n    const output: { [key: string]: unknown } = {};\n    const style: { [key: string]: unknown } = {};\n    let touched = false;\n    for (var key in props) {\n      if (props.hasOwnProperty(key)) {\n        if (key.startsWith(propPrefix)) {\n          style[key.substr(1)] = props[key];\n          touched = true;\n        } else {\n          output[key] = props[key];\n        }\n      }\n    }\n    if (touched) {\n      const className = renderStyle(style);\n      output.className = output.className\n        ? `${output.className} ${className}`\n        : className;\n    }\n    return output;\n  };\n}\n","import { Modifier } from \"./Modifier\";\n\nfunction isUpperCase(str: string): boolean {\n  return str !== str.toLowerCase() && str === str.toUpperCase();\n}\n\nexport type ModifierMap = {\n  [key: string]: Modifier;\n};\n\nfunction cache<T>(fn: (key: string) => T): (key: string) => T {\n  const store: { [key: string]: T } = {};\n  return (key: string) => {\n    if (!store[key]) {\n      store[key] = fn(key);\n    }\n    return store[key];\n  };\n}\n\nexport function createParser(prefixMap: ModifierMap, suffixMap: ModifierMap) {\n  const prefixes = Object.keys(prefixMap);\n  const suffixes = Object.keys(suffixMap);\n\n  function parsePrefix(key: string): [string, Modifier[]] {\n    const match = prefixes.find(item => {\n      return (\n        key.length > item.length &&\n        isUpperCase(key[item.length]) &&\n        key.startsWith(item)\n      );\n    });\n    if (match) {\n      const modifier = prefixMap[match];\n      const [inner, mods] = parsePrefix(\n        key[match.length].toLowerCase() + key.slice(match.length + 1)\n      );\n      return [inner, [...mods, modifier]];\n    }\n    return [key, []];\n  }\n  function parseSuffix(key: string): [string, Modifier[]] {\n    const match = suffixes.find(item => {\n      return key.length > item.length && key.endsWith(item);\n    });\n    if (match) {\n      const modifier = suffixMap[match];\n      const [inner, mods] = parseSuffix(\n        key.substring(0, key.length - match.length)\n      );\n      return [inner, [...mods, modifier]];\n    }\n    return [key, []];\n  }\n  function parse(key: string): [string, Modifier[]] {\n    const [first, prefixMods] = parsePrefix(key);\n    const [innerKey, suffixMods] = parseSuffix(first);\n    return [\n      innerKey,\n      Modifier.combineModifiers([...prefixMods, ...suffixMods])\n    ];\n  }\n  return cache(parse);\n}\n"],"names":["getClassName","instance","Reflect","getPrototypeOf","constructor","name","const","modifiers","Modifier","value","type","id","this","mod","canCombine","_withMod","combine","withMod","Error","getKey","toString","combineModifiers","mods","reduce","sum","item","last","length","slice","MediaModifier","PseudoModifier","getProps","modifier","props","Node","set","key","node","getNode","Active","Checked","Default","Disabled","Empty","Enabled","First","FirstChild","FirstOfType","Fullscreen","Focus","Hover","Indeterminate","InRange","Invalid","LastChild","LastOfType","Link","OnlyChild","OnlyOfType","Optional","OutOfRange","ReadOnly","ReadWrite","Required","Scope","Target","Valid","Visited","defaultMediaPrefixes","Object","keys","process","env","filter","startsWith","target","replace","assign","createRenderStyle","defaultPseudos","prefixMap","suffixMap","fn","store","prefixes","suffixes","parser","mediaPrefixes","pseudoSuffixes","parsePrefix","match","find","str","toLowerCase","toUpperCase","parseSuffix","endsWith","substring","prefixMods","hasOwnProperty","substr","tx","renderDeclarativeRules","styletron","renderStyle","emptyRender","stilrenContext","React","createContext","StilrenConsumer","Consumer","createExtender","propPrefix","_tagName","output","style","touched","className","useMemo","extender","ctx","originalCreateElement","Provider","ExtensionProvider","children","useContext","console","warn"],"mappings":"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"}